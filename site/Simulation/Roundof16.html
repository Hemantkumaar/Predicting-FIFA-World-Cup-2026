<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Round of 16 - FIFA 2026</title>

<style>
body{
margin:0;
font-family:system-ui;
background:linear-gradient(180deg,#070b14,#0b1220);
color:white;
}

.container{
max-width:1300px;
margin:auto;
padding:40px 20px;
}

h1{text-align:center;margin-bottom:30px;}

.match{
background:rgba(18,28,51,.85);
padding:20px;
border-radius:15px;
border:1px solid rgba(255,255,255,.1);
margin-bottom:25px;
}

.teams{
display:flex;
gap:15px;
}

.teamBtn{
flex:1;
padding:12px;
border-radius:10px;
border:1px solid rgba(255,255,255,.2);
background:rgba(255,255,255,.05);
color:white;
font-weight:bold;
cursor:pointer;
}

.teamBtn:disabled{
opacity:.5;
cursor:not-allowed;
}

.predictBtn{
margin-top:15px;
padding:8px 14px;
background:#f6c453;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

.simAllBtn{
margin-bottom:30px;
padding:10px 20px;
background:#28a745;
border:none;
border-radius:10px;
color:white;
font-weight:bold;
cursor:pointer;
}

.backBtn, .nextBtn{
position:fixed;
bottom:30px;
width:60px;
height:60px;
border-radius:50%;
border:none;
background:linear-gradient(135deg,#f6c453,#d4a017);
color:#000;
font-size:26px;
font-weight:bold;
cursor:pointer;
}

.backBtn{ left:30px; }
.nextBtn{ right:30px; }
</style>
</head>

<body>

<!-- persistent soundtrack for tournament flow; local file -->
<audio id="globalSong" src="champion.mp3" preload="auto"></audio>

<div class="container">
<h1>üèÜ Round of 16</h1>

<button class="simAllBtn" onclick="simulateAll()">Simulate All Matches</button>

<div id="matches"></div>
</div>

<button class="backBtn" onclick="window.location.href='knockout.html'">‚Üê</button>
<button class="nextBtn" onclick="goNext()">‚ûú</button>

<script>

function initGlobalSong(){
    const song=document.getElementById('globalSong');
    if(!song){ console.warn('‚ö† globalSong element not found'); return; }
    const t=parseFloat(localStorage.getItem('songTime')||0);
    const wasPlaying=localStorage.getItem('songPlaying')==='true';
    if(!isNaN(t) && t>0) song.currentTime=t;
    song.volume=1;
    console.log('üéµ Roundof16: resumed at', t.toFixed(2)+'s, will play:', wasPlaying);
    if(wasPlaying){
        song.play().then(()=>{
            console.log('‚úì Audio resumed playing');
            localStorage.setItem('songPlaying','true');
        }).catch(err=>console.warn('‚ö† Resume failed:',err.message));
    }
    setInterval(()=>localStorage.setItem('songTime',song.currentTime),500);
    song.addEventListener('play',()=>localStorage.setItem('songPlaying','true'));
    song.addEventListener('pause',()=>localStorage.setItem('songPlaying','false'));
}
document.addEventListener('DOMContentLoaded',initGlobalSong);

/* -------- LOAD ROUND 32 WINNERS -------- */

let teams = JSON.parse(localStorage.getItem("round32_winners"));

if(!teams || teams.length !== 16){
alert("Complete Round of 32 first!");
window.location.href="knockout.html";
}

/* -------- VARIABLES -------- */

let r16Winners = new Array(8).fill(null);
let votes={}, locked={};

const container=document.getElementById("matches");

/* -------- GENERATE MATCHES -------- */

for(let i=0;i<16;i+=2){

votes[i]={t1:0,t2:0};
locked[i]=false;

const team1=teams[i];
const team2=teams[i+1];

const div=document.createElement("div");
div.className="match";

div.innerHTML=`
<div class="teams">
<button class="teamBtn" id="t1-${i}" onclick="vote(${i},1)">
${team1.name}
</button>
<button class="teamBtn" id="t2-${i}" onclick="vote(${i},2)">
${team2.name}
</button>
</div>

<button class="predictBtn" onclick="predict(${i})">
Run 10,000 Simulations
</button>
`;

container.appendChild(div);
}

/* -------- VOTING -------- */

function vote(i,team){
if(locked[i]) return;

locked[i]=true;
document.getElementById(`t1-${i}`).disabled=true;
document.getElementById(`t2-${i}`).disabled=true;
}

/* -------- MONTE CARLO -------- */

function predict(i){

const team1=teams[i];
const team2=teams[i+1];

const SIM=10000;
let t1Wins=0, t2Wins=0;

for(let s=0;s<SIM;s++){
const total=team1.perf+team2.perf;
const prob=team1.perf/total;
if(Math.random()<prob) t1Wins++;
else t2Wins++;
}

const winner = t1Wins>t2Wins ? team1 : team2;

/* SAVE PROPERLY */
r16Winners[i/2]=winner;
localStorage.setItem("round16_winners", JSON.stringify(r16Winners));

alert(`${winner.name} advances to Quarterfinals!`);
}

/* -------- SIMULATE ALL -------- */

function simulateAll(){
for(let i=0;i<16;i+=2){
predict(i);
}
alert("All Round of 16 matches simulated!");
}

/* -------- NEXT -------- */

function goNext(){
const saved=JSON.parse(localStorage.getItem("round16_winners"))||[];

if(saved.filter(Boolean).length !== 8){
alert("Complete all 8 matches first!");
return;
}

window.location.href="quarterfinals.html";
}

</script>

</body>
</html>