<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Round of 16 - FIFA 2026</title>

<style>
body{
margin:0;
font-family:system-ui;
background:linear-gradient(180deg,#070b14,#0b1220);
color:white;
}

.container{
max-width:1300px;
margin:auto;
padding:40px 20px;
}

h1{text-align:center;margin-bottom:30px;}

.match{
background:rgba(18,28,51,.85);
padding:20px;
border-radius:15px;
border:1px solid rgba(255,255,255,.1);
margin-bottom:25px;
}

.teams{
display:flex;
gap:15px;
}

.teamBtn{
flex:1;
padding:12px;
border-radius:10px;
border:1px solid rgba(255,255,255,.2);
background:rgba(255,255,255,.05);
color:white;
font-weight:bold;
cursor:pointer;
}

.teamBtn:disabled{
opacity:.5;
cursor:not-allowed;
}

.predictBtn{
margin-top:15px;
padding:8px 14px;
background:#f6c453;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

.simAllBtn{
margin-bottom:30px;
padding:10px 20px;
background:#28a745;
border:none;
border-radius:10px;
color:white;
font-weight:bold;
cursor:pointer;
}

.backBtn, .nextBtn{
position:fixed;
bottom:30px;
width:60px;
height:60px;
border-radius:50%;
border:none;
background:linear-gradient(135deg,#f6c453,#d4a017);
color:#000;
font-size:26px;
font-weight:bold;
cursor:pointer;
}

.backBtn{ left:30px; }
.nextBtn{ right:30px; }
</style>
</head>

<body>

<!-- persistent soundtrack for tournament flow -->
<audio id="globalSong" src="champion.mp3" preload="auto"></audio>

<!-- Global Audio Player UI -->
<div style="position:fixed;bottom:20px;right:20px;z-index:9999;background:rgba(0,0,0,.95);padding:10px 12px;border-radius:8px;border:2px solid #f6c453;display:flex;align-items:center;gap:8px;font-size:11px;box-shadow:0 4px 20px rgba(0,0,0,.8);font-family:system-ui;">
  <button id="playPauseBtn" style="background:#f6c453;color:#000;border:none;padding:5px 8px;border-radius:4px;cursor:pointer;font-weight:bold;font-size:12px;line-height:1;" onclick="togglePlayPause()">‚ñ∂</button>
  <span style="color:#a9b4d0;font-size:10px;">üéµ Waka Waka</span>
  <div style="width:80px;height:2px;background:rgba(255,255,255,.2);border-radius:1px;overflow:hidden;"><div id="progressBar" style="height:100%;background:#f6c453;width:0%;"></div></div>
</div>

<div class="container">
<h1>üèÜ Round of 16</h1>

<button class="simAllBtn" onclick="simulateAll()">Simulate All Matches</button>

<div id="matches"></div>
</div>

<button class="backBtn" onclick="window.location.href='knockout.html'">‚Üê</button>
<button class="nextBtn" onclick="goNext()">‚ûú</button>

<script>

/* -------- GLOBAL SOUNDTRACK CONTROLS -------- */
function initGlobalSong(){
  const song=document.getElementById('globalSong');
  const btn=document.getElementById('playPauseBtn');
  if(!song) return;
  song.volume=1;
  const t=parseFloat(sessionStorage.getItem('audioTime')||localStorage.getItem('songTime')||0);
  const wasPlaying=sessionStorage.getItem('audioPlaying')==='true'||localStorage.getItem('songPlaying')==='true';
  if(!isNaN(t) && t>0) song.currentTime=t;
  console.log('üéµ Roundof16: time='+t.toFixed(1)+'s, wasPlaying='+wasPlaying);
  const updateProgress=()=>{
    const bar=document.getElementById('progressBar');
    if(bar && song.duration) bar.style.width=((song.currentTime/song.duration)*100)+'%';
  };
  setInterval(()=>{
    sessionStorage.setItem('audioTime',song.currentTime);
    localStorage.setItem('songTime',song.currentTime);
    updateProgress();
  },500);
  song.addEventListener('play',()=>{
    sessionStorage.setItem('audioPlaying','true');
    localStorage.setItem('songPlaying','true');
    if(btn) btn.textContent='‚è∏';
  });
  song.addEventListener('pause',()=>{
    sessionStorage.setItem('audioPlaying','false');
    localStorage.setItem('songPlaying','false');
    if(btn) btn.textContent='‚ñ∂';
  });
  if(btn) btn.textContent=wasPlaying?'‚è∏':'‚ñ∂';
  if(wasPlaying){
    song.play().then(()=>{
      console.log('‚úì Resumed on Roundof16');
      if(btn) btn.textContent='‚è∏';
    }).catch(err=>{
      console.log('‚ö† Autoplay blocked');
      if(btn) btn.textContent='‚ñ∂';
    });
  }
}
function togglePlayPause(){
  const song=document.getElementById('globalSong');
  if(song.paused) song.play().catch(err=>console.warn('Play failed:',err.message));
  else song.pause();
}
document.addEventListener('DOMContentLoaded',initGlobalSong);/* -------- LOAD ROUND 32 WINNERS -------- */

let teams = JSON.parse(localStorage.getItem("round32_winners"));

if(!teams || teams.length !== 16){
alert("Complete Round of 32 first!");
window.location.href="knockout.html";
}

/* -------- VARIABLES -------- */

let r16Winners = new Array(8).fill(null);
let votes={}, locked={};

const container=document.getElementById("matches");

/* -------- GENERATE MATCHES -------- */

for(let i=0;i<16;i+=2){

votes[i]={t1:0,t2:0};
locked[i]=false;

const team1=teams[i];
const team2=teams[i+1];

const div=document.createElement("div");
div.className="match";

div.innerHTML=`
<div class="teams">
<button class="teamBtn" id="t1-${i}" onclick="vote(${i},1)">
${team1.name}
</button>
<button class="teamBtn" id="t2-${i}" onclick="vote(${i},2)">
${team2.name}
</button>
</div>

<button class="predictBtn" onclick="predict(${i})">
Run 10,000 Simulations
</button>
`;

container.appendChild(div);
}

/* -------- VOTING -------- */

function vote(i,team){
if(locked[i]) return;

locked[i]=true;
document.getElementById(`t1-${i}`).disabled=true;
document.getElementById(`t2-${i}`).disabled=true;
}

/* -------- MONTE CARLO -------- */

function predict(i){

const team1=teams[i];
const team2=teams[i+1];

const SIM=10000;
let t1Wins=0, t2Wins=0;

for(let s=0;s<SIM;s++){
const total=team1.perf+team2.perf;
const prob=team1.perf/total;
if(Math.random()<prob) t1Wins++;
else t2Wins++;
}

const winner = t1Wins>t2Wins ? team1 : team2;

/* SAVE PROPERLY */
r16Winners[i/2]=winner;
localStorage.setItem("round16_winners", JSON.stringify(r16Winners));

alert(`${winner.name} advances to Quarterfinals!`);
}

/* -------- SIMULATE ALL -------- */

function simulateAll(){
for(let i=0;i<16;i+=2){
predict(i);
}
alert("All Round of 16 matches simulated!");
}

/* -------- NEXT -------- */

function goNext(){
const saved=JSON.parse(localStorage.getItem("round16_winners"))||[];

if(saved.filter(Boolean).length !== 8){
alert("Complete all 8 matches first!");
return;
}

window.location.href="quarterfinals.html";
}

</script>

</body>
</html>